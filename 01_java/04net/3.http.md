1. http，url 介绍
2. 一次完整的http请求过程
3. DNS劫持与HTTP劫持
4. HTTP 1.0，1.1，2.0特性与区别



#### 1.HTTP

- HTTP协议是超文本传输协议（Hyper Text Transfer Protocol）的缩写，是用于从万维网（www）服务器传输超文本到本地浏览器的传送协议
- 我们使用http来访问web上某个资源，比如html/文本，word，avi电影，其他资源。
- Http使用统一资源标识符（URI）来传输数据和建立连接，URL是一种特殊类型的URI
  - URI是统一资源标识符
  - URL是统一资源定位符
  - 每个URL都是URI，但不一定每个URI都是URL

##### 一个完整的URL

**http://www.enjoyedu.com:8080/news/index.asp?boardID=5&ID=24618&page=1#name**

1. 协议部分：该URL的协议部分是“http：”，这代表网页使用的是HTTP协议。
   - 在Internet中可以使用多种协议，如HTTP，FTP等等，在HTTP后面的“//”为分隔符
2. 域名部分：该URL的域名部分为“www.engoyedu.com” ，一个URL中，也可以使用IP地址作为域名使用
3. 端口部分：跟在域名后面的是端口，域名和端口之间使用 “：”作为分隔符。
   - 端口不是一个URL必须的部分，如果省了端口部分，将采用默认端口
4. 虚拟目录部分：从域名后的第一个“/”开始到最后一个“/” 为止，是虚拟目录部分。
   - 虚拟目录也不是一个URL必须的部分，本例中的虚拟目录是/news/
5. 文件名部分：从域名后的最后一个“/” 开始到“？”为止，是文件名部分，如果没有“？”，则是从域名后的最后一个“/” 开始到“#” 为止，是文件部分，如果没有“？”和“#”，那么域名后的最后一个“/”开始到结束，都是文件名部分
   - 本例中的文件名是“ index.asp”,文件名也不是URL必须的部分，如果没有，则使用默认的文件名
6. 参数部分：从“？”开始到“#”为止之间的部分为参数部分，又称搜索部分，查询部分。
   - 本例中的参数部分为“boardID=5&ID=24618&page=1”，参数可以允许由多个，参数与参数之间使用“&”作为分隔符
7. 锚部分：从“#”开始到最后，都是锚部分

#### 2.一次完整的http请求过程

1. 首先进行DNS域名解析（本地浏览器缓存，操作系统缓存或者DNS服务器），首先会搜索浏览器自身的DNS缓存（缓存时间比较短，大概只有1分钟，且只能容纳1000条缓存）
   - 如果浏览器自身的缓存里面没有找到，那么浏览器会搜索系统自身的DNS缓存
   - 如果还没有找到，那么尝试从hosts文件里面去找
   - 在前面三个过程都没有获取到的情况下，就去域名服务器去查找
2. 三次握手建立TCP连接
   - 在HTTP工作开始之前，客户端首先通过网络与服务器建立连接，HTTP连接时通过TCP来完成的。
   - HTTP是比TCP更高层次的应用层协议，根据规则，只有底层协议建立之后，才能进行高层协议的来凝结，因此，首先要建立TCP连接，一般TCP连接的端口是80
3. 客户端发起HTTP请求
4. 服务端响应HTTP请求
5. 客户端解析html代码，并请求html代码中的资源
   - 浏览器拿到html文件后，就开始解析其中的html代码，遇到js/css/image等静态资源时，就向服务器端去请求下载
6. 客户端渲染展示内容
7. 关闭TCP连接

##### 一般情况下，一旦服务器向客户端返回了请求数据，它就要关闭TCP连接

- 如果客户端或者服务器在其头部信息加入Connection:kttp-alive，TCP连接在发送后将仍然保持打开状态。
- 于是，客户端可以继续通过相同的连接发送请求，也就说前面的3到6步骤，可以反复进行。
- 保持连接节省了为每个请求建立新连接所需的时间，还节约了网络宽带

<img src=".\res3\1.http请求过程.png" alt="1.http请求过程" style="zoom:70%;" />

#### 3.DNS劫持和HTTP劫持

##### 3.1.DNS劫持

- DNS是Domain Name System的简写，即域名系统，他是可以将域名和IP地址相互映射的一个分布式数据库，能够使人更方便的访问互联网。所以我们只需要输入网站，dns可以将域名地址解析成对应的ip地址进行访问，用户就不需要记住复杂的ip地址了
- DNS劫持：是通过劫持了DNS服务器，通过某些手段取得某域名的解析记录控制权，进而修改域名的解析结果，导致对该域名的访问由原IP地址转入到修改后的指定IP，其结果就是对特定的网站不能访问或访问的是假网站，从而实现窃取资料或者破坏原有正常服务的目的。
  - DNS劫持通过篡改DNS服务器上的数据放回给用户一个错误的查询结果来实现的。

##### 3.2.HTTP劫持

- Http劫持是在运营商的路由器节点上，设置协议检测，一旦发现是HTTP请求，而且是html类型请求，则拦截处理。

防http劫持思路：

1. 采用https协议加密请求
2. 隐藏http请求的特征，例如使用对称加密算法加密整个url。

#### 4.Http无状态协议

- 无状态协议对于事物处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息
  - 也就是说，当客户端一次HTTP请求完成之后，客户端再次发送一次HTTP请求，HTTP并不知道当前客户端是一个"老用户"
- 解决办法：Cookie
  - Cookie相当于一个通信证，第一次访问的时候给客户端发送一个Cookie，当客户端再次请求的时候，带上Cookie，那么服务器就知道这个世"老用户"

#### 5.Http常见状态吗

~~~java
200：请求被正常处理
204：请求被受理但没有资源可以返回
206：客户端只是请求资源的一部分，服务器只对请求的部分资源执行GET方法，相应报文中通过Content-Range指定范围的资源。
301：永久性重定向
302：临时重定向
303：与302状态码有相似功能，只是它希望客户端在请求一个URI的时候，能通过GET方法重定向到另一个URI上
304：发送附带条件的请求时，条件不满足时返回，与重定向无关
307：临时重定向，与302类似，只是强制要求使用POST方法
400：请求报文语法有误，服务器无法识别
401：请求需要认证
403：请求的对应资源禁止被访问
404：服务器无法找到对应资源
500：服务器内部错误
503：服务器正忙
~~~

#### 6.HTTP请求方法

~~~java
GET： 用于请求访问已经被URI（统一资源标识符）识别的资源，可以通过URL传参给服务器
POST：用于传输信息给服务器，主要功能与GET方法类似，但一般推荐使用POST方式。
PUT： 传输文件，报文主体中包含文件内容，保存到对应URI位置。
HEAD： 获得报文首部，与GET方法类似，只是不返回报文主体，一般用于验证URI是否有效。
DELETE：删除文件，与PUT方法相反，删除对应URI位置的文件。
OPTIONS：查询相应URI支持的HTTP方法
~~~

#### 7.HTTP1.0 与 HTTP1.1 区别

- HTTP1.0最早在1996年在网页中使用，HTTP1.1 在1999年开始应用于各大浏览器网络请求中，也是当前使用最为广泛的HTTP协议
- 主要体现如下：
  - 缓存处理
  - 宽带优化及网络连接的使用
  - 错误通知的管理
  - Host头处理
  - 长连接
    - Http1.1支持长连接和请求的流水线处理，在一个TCP连接上可以传送多个HTTP请求和响应，减少了建立和关闭连接的消耗和延迟。

#### 8.HTTP2.0新特性

- 1.新的二进制格式（Binary Format）
  - HTTP1.x的解析是基于文本。基于文本协议的格式解析存在缺陷，文本的表现形式有多样性，要考虑的场景较多（json，xml等）；
  - 二进制则不同，只认0和1的组合，实现方便和健壮
- 2.多路复用（MultiPlexing）
  - 连接共享，即每一个request都是用作连接共享机制的。一个request对应一个id，一个链接上可以有多个request，每个连接的request可以随机的混杂在一起，接收放可以根据request的id将request再归属到各自不同的服务端请求里面
- 3.header压缩
  - HTTP1.x的header带有大量信息，而且每次都要重复发送，HTTP2.0使用encoder来减少需要传输的header大小。
- 4.服务端推送：http2.0具有server push功能

##### HTTP2.0的多路复用与HTTP1.x中的长连接复用区别

- HTTP1.x 一次请求/响应，建立一个连接，用完关闭，每一个请求都要建立一个连接：
- HTTP1.1 Pipeling（流水线）的解决方式为：若干个请求排队串行化单线程处理，后面的请求等待前面请求的返回才能获得执行机会，一旦有某个请求超时等待，后续请求只能被阻塞，毫无办法，也就是常说的线头阻塞
- HTTP2.0 多个请求可同时在一个链接上并行执行，某个请求任务耗时严重时，不会影响到其他连接的正常执行





