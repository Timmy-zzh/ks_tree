1. https



#### 1.HTTP缺点

- 通信使用明文（不加密），内容可能会被窃听
- 不验证通信方的身份，因此有可能遭遇伪装
- 无法证明保文的完整性，所以有可能已遭篡改

##### 加密处理：

- 通信的加密
  - HTTP协议中没有加密机制，但可以通过和SSL（Secure Socket Layer，安全套接层）或TLS（Transport Layer Security,安全层传输协议）的组合使用，加密HTTP的通信内容
  - 用SSL建立安全通信线路之后，就可以在这条线路上进行HTTP通信了。与SSL组合使用的HTTP被称为HTTPS（HTTP Secure，超文本传输安全协议）
- 内容的加密
  - 对HTTP协议传输的内容本身加密，即把HTTP报文里所含的内容进行加密处理，客户端对HTTP报文进行加密处理后再发送请求

#### 2.HTTPS = HTTP + 加密 + 认证 + 完整性保护

- http加上加密处理和认证以及完整性保护后即是https
- https是身披ssl外壳的http

<img src=".\res4\1.https=http+ssl.png" alt="1.https=http+ssl" style="zoom:50%;" />

##### 2.1.相互交换密钥的公开密钥加密技术

- 共享密钥加密
  - 加密和解密使用同一个密钥的方式称为共享密钥加密，也叫做对称密钥加密
- 使用两把密钥的公开密钥加密
  - 公开密钥加密使用一对非对称的密钥，一把叫做私有密钥，另一把叫做公开密钥；私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人读可以获得
  - 发送密文的一方使用对方的公开密钥进行加密处理，对方收到被加密的信息后，再使用自己的私有密钥进行解密。

##### 2.2.HTTPS采用混合加密机制

- 公开密钥加密与共享密钥加密相比，公开密钥加密的处理速度更慢，为发挥两者各自的优势进行组合使用，在交换密钥环节使用公开密钥加密方式，之后的建立通信交换保文阶段则使用共享密钥加密方式。

##### 2.3.证明公开密钥正确性的证书

- 公开密钥加密方式存在的一些问题：
  - 无法证明公开密钥本身就是货真价实的公开密钥。比如，正准备和某台服务器建立公开密钥加密方式下的通信时，如何证明收到的公开密钥就是原本预想的那台服务器发行的公开密钥。
  - 或许在公开密钥传输途中，真正的公开密钥已经被攻击者替换掉了
- 解决方案：使用由数字证书认证机构（CA）和其相关机关颁发的公开密钥证书

##### 数字证书认证机构处于客户端与服务器双方都可信赖的第三方机构

数字证书认证机构的业务流程：

1. 服务器的营运人员向数字证书认证机构提出公开密钥的申请。
2. 数字证书认证机构在判明提出申请者的身份之后，会对已申请的公开密钥做**数字签名**，然后分配这个已签名的公开密钥
3. 并将该公开密钥放入公钥证书后绑定在一起

##### 证书校验流程：

1. 服务器将这份由数字证书认证机构颁发的公钥证书发送给客户端，以进行公开密钥加密方式通信
2. 接收到证书的客户端可使用数字证书认证机构的公开密钥，对那张证书上的数字签名进行验证，一旦验证通过，客户端便可明确两件事：
   - 认证服务器的公开密钥是真实有效的数字证书认证机构
   - 服务器的公开密钥是值得信赖的

##### 认证机关的公开密钥必须安全地转交给客户端，使用通信方式时，如何安全转交是一件很困难的事。

- 因此，多数浏览器开发商发布版本时，会事先在内部植入常用认证机关的公开密钥s

<img src=".\res4\2.数字证书认证流程.png" alt="2.数字证书认证流程" style="zoom:100%;" />

#### 3.HTTPS通信步骤

<img src=".\res4\3.https通信流程.png" alt="3.https通信流程" style="zoom:100%;" />

1. 客户端通过发送Client Hello报文开始SSL通信。报文中包含客户端支持的SSL的指定版本，加密组件（Clipher Suite）列表（所使用的加密算法及密钥长度等）
2. 服务器可进行SSL通信时，会以Server Hello报文作为应答。和客户端一样，在报文中包含SSL版本以及加密组件。服务器的加密组件内容是从接收到的客户端加密组件列表中刷选出来的
3. 之后服务器发送Certificate报文，报文中包含了公开密钥证书
4. 最后服务端发送Server Hello Done报文通知客户端，最初阶段的SSL握手协商部分结束
5. SSL第一次握手结束之后，客户端以Client Key Exchange报文作为回应，报文中的内容是使用步骤3中的公开密钥进行加密后的随机密码串。（报文中包含通信加密中使用的一种被称为Pre-master secret的随机密码串）
6. 接着客户端继续发送Change Clipher Spec报文。该报文会提示服务器，在此报文之后的通信会采用Pre-master secret密钥加密
7. 客户端发送Finished报文。该报文包含连接至今全部报文的整体校验值。这次握手协商是否能够成功，要以服务器能否正确解密该报文作为判定标准
8. 服务器同样发送Change Clipher Spec报文
9. 服务器同样发送Finished报文
10. 服务器和客户端的Finished报文交换完毕之后，SSL连接就算建立完成。当然，通信会受到SSL的保护。从此处开始进行应用层协议的通信，即发送HTTP请求
11. 应用层协议通信，即发送HTTP响应
12. 最后由客户端断开连接。断开连接时，发送close_notify报文。（这步之后再发送TCP FIN报文来关闭与TCP的通信）

![3.1.https通信流程图解与CBC模式](.\res4\3.1.https通信流程图解与CBC模式.png)

##### 3.2HTTPS方式与Web服务器通信时的步骤

- 1.客户使用https的URL访问Web服务器，要求与Web服务器建立SSL连接
- 2.Web服务器收到客户端请求后，会将网站的证书信息传送一份给客户端
  - 证书中包含服务器公钥（非对称加密）
  - HTTPS中，服务端将公钥发给数字证书认证机构进行安全认证并对公钥进行数字签名，完成后公钥和签名组合成数字证书
  - 在和客户端通信时，服务端将数字证书发给客户端，客户端通过第三方安全认证机构（内置在浏览器中）对数字证书上的签名进行验证
- 3.客户端的浏览器与Web服务器开始协商SSL连接的安全等级，也就是信息加密的等级
- 4.客户端的浏览器根据双方同意的安全等级，建立会话密钥(对称加密)，然后利用服务器公钥将会话密钥加密，并传送给网站
- 5.Web服务器利用自己的私钥解密出会话密钥
- 6.Web服务器利用会话密钥加密与客户端之间的通信



